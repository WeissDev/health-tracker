var app=app||{};app.FoodModel=Backbone.Model.extend({defaults:{name:"",brand:"",calories:0,index:1}});var app=app||{},SelectedCollection=Backbone.Collection.extend({model:app.FoodModel,localStorage:new Backbone.LocalStorage("selected-backbone")});app.SelectedCollection=new SelectedCollection;var app=app||{},FoodCollection=Backbone.Collection.extend({model:app.FoodModel,localStorage:new Backbone.LocalStorage("results-backbone")});app.FoodCollection=new FoodCollection;var app=app||{};app.SelectedFoodView=Backbone.View.extend({tagName:"tr",template:_.template($("#user-select-template").html()),events:{"click .destroy":"removeItem"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){return this.$el.html(this.template(this.model.attributes)),this},removeItem:function(){this.model.destroy()}});var app=app||{};app.ResultsView=Backbone.View.extend({tagName:"tr",template:_.template($("#search-results-template").html()),events:{"click .add":"addToSelected"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){return this.$el.html(this.template(this.model.attributes)),this},addToSelected:function(){var e=new app.FoodModel({name:this.model.get("name"),brand:this.model.get("brand"),calories:this.model.get("calories"),index:app.FoodModel.length});app.SelectedCollection.create(e)}});var app=app||{};app.AppView=Backbone.View.extend({el:"#health-tracker",template:_.template($("#stats-template").html()),events:{"click #search-btn":"getJson","click #clear-btn":"clearResults"},initialize:function(){this.listenTo(app.FoodCollection,"add",this.addResponse),this.listenTo(app.SelectedCollection,"add",this.addOne),this.listenTo(app.SelectedCollection,"reset",this.addAll),this.listenTo(app.SelectedCollection,"all",this.render),app.FoodCollection.fetch(),app.SelectedCollection.fetch()},render:function(){var e=app.SelectedCollection.length,a=0;app.SelectedCollection.forEach(function(e){a+=e.get("calories")}),app.SelectedCollection.length?($("#stats").show(),$("#stats").html(this.template({remaining:e,totalCalories:a}))):$("#stats").hide(),this.intakeCanvas(a)},addOne:function(e){var a=new app.SelectedFoodView({model:e});$("#user-select").append(a.render().el)},addAll:function(){this.$("#user-select").html(""),app.SelectedCollection.each(this.addOne,this)},addResponse:function(e){var a=new app.ResultsView({model:e});$("#search-results").append(a.render().el)},getJson:function(){$("#search-results").empty();var e=$("#search-bar").val(),a="https://api.nutritionix.com/v1_1/search/"+e+"?results=0:20&fields=item_name,brand_name,item_id,nf_calories&appId=7609e232&appKey=0a249bb0ad1fc18455fde567706ebba7";$.ajax({method:"GET",url:a,dataType:"json",success:function(e){for(var a=e.hits,t=0;t<a.length;t++){var s=new app.FoodModel({name:a[t].fields.item_name,brand:a[t].fields.brand_name,calories:a[t].fields.nf_calories,index:t});app.FoodCollection.create(s)}},error:function(){$("#search-results").append("<p>Couldn't get Nutritionix data. Check your internet connection or try again later.</p>")}})},clearResults:function(){return _.invoke(app.FoodCollection.toArray(),"destroy"),this.$("#search-bar").val(""),!1},intakeCanvas:function(e){var a={labels:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],datasets:[{fillColor:"#48A497",strokeColor:"#48A4D1",data:[0,0,0,0,0,0,0]}]};switch((new Date).getDay()){case 0:a.datasets[0].data[6]=e;break;case 1:a.datasets[0].data[0]=e;break;case 2:a.datasets[0].data[1]=e;break;case 3:a.datasets[0].data[2]=e;break;case 4:a.datasets[0].data[3]=e;break;case 5:a.datasets[0].data[4]=e;break;case 6:a.datasets[0].data[5]=e}var t=document.getElementById("bar-chart-weekly").getContext("2d");new Chart(t).Bar(a);var s={labels:["January","February","March","April","May","June","July","August","September","October","November","December"],datasets:[{fillColor:"#48A497",strokeColor:"#48A4D1",data:[0,0,0,0,0,0,0,0,0,0,0,0]}]};switch((new Date).getMonth()){case 0:s.datasets[0].data[0]=e;break;case 1:s.datasets[0].data[1]=e;break;case 2:s.datasets[0].data[2]=e;break;case 3:s.datasets[0].data[3]=e;break;case 4:s.datasets[0].data[4]=e;break;case 5:s.datasets[0].data[5]=e;break;case 6:s.datasets[0].data[6]=e;break;case 7:s.datasets[0].data[7]=e;break;case 8:s.datasets[0].data[8]=e;break;case 9:s.datasets[0].data[9]=e;break;case 10:s.datasets[0].data[10]=e;break;case 11:s.datasets[0].data[11]=e}var o=document.getElementById("bar-chart-monthly").getContext("2d");new Chart(o).Bar(s)}});var app=app||{};$(function(){new app.AppView});